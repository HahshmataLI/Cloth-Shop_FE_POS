<div class="p-6 space-y-4">

  <!-- Customer + SKU row -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-3">

    <!-- Customer -->
    <div>
      <label class="block mb-1">Customer</label>
      <p-select
        [options]="customers"
        optionLabel="name"
        [(ngModel)]="selectedCustomer"
        placeholder="Select customer"
        class="w-full">
      </p-select>
    </div>

    <!-- SKU -->
    <div>
      <label class="block mb-1">SKU (scan or enter)</label>
      <div class="flex gap-2">
        <input
          #skuInputEl
          pInputText
          [(ngModel)]="skuInput"
          (keyup.enter)="addBySku()"
          placeholder="Scan or type SKU then Enter"
          class="w-full" />
        <button pButton label="Add" icon="pi pi-plus" (click)="addBySku()"></button>
      </div>
    </div>

    <!-- Payment -->
    <div>
      <label class="block mb-1">Payment</label>
      <p-select
        [options]="['Cash','Card','JazzCash','Easypaisa','BankTransfer','Credit']"
        [(ngModel)]="paymentMethod"
        placeholder="Payment method"
        class="w-full">
      </p-select>
    </div>
  </div>

  <!-- Category & Subcategory selectors -->
  <div>
    <label class="block mb-2">Quick Add Products</label>

    <!-- Categories -->
    <div class="flex gap-2 flex-wrap mb-3">
      <button
        *ngFor="let c of categories"
        class="px-3 py-2 rounded border"
        [class.bg-blue-600]="selectedCategory?._id === c._id"
        [class.text-white]="selectedCategory?._id === c._id"
        (click)="selectCategory(c)">
        {{ c.name }}
      </button>
    </div>

    <!-- Subcategories -->
    <div *ngIf="subCategories.length > 0" class="flex gap-2 flex-wrap mb-3">
      <button
        *ngFor="let sc of subCategories"
        class="px-3 py-2 rounded border"
        [class.bg-indigo-600]="selectedSubCategory?._id === sc._id"
        [class.text-white]="selectedSubCategory?._id === sc._id"
        (click)="selectSubCategory(sc)">
        {{ sc.name }}
      </button>
    </div>

    <!-- Products -->
    <div *ngIf="filteredProducts.length > 0" class="flex gap-2 flex-wrap">
      <button
        *ngFor="let p of filteredProducts"
        class="px-3 py-2 rounded bg-gradient-to-r from-blue-600 to-indigo-500 text-white"
        (click)="addProduct(p)">
        {{ p.name }} - {{ p.salePrice | currency:'PKR' }}
      </button>
    </div>
  </div>

  <!-- Cart table -->
  <p-table [value]="saleItems" class="w-full">
    <ng-template pTemplate="header">
      <tr>
        <th>Product</th>
        <th>Price</th>
        <th>Qty</th>
        <th>Discount</th>
        <th>Subtotal</th>
        <th></th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-item let-i="rowIndex">
      <tr>
        <td>{{ item.product.name }}</td>
        <td>{{ item.price | currency:'PKR' }}</td>
        <td>
          <input type="number" min="1" class="w-20 p-1 border rounded"
                 [(ngModel)]="item.quantity"
                 (ngModelChange)="updateQuantity(item, $event)" />
        </td>
        <td>
          <input type="number" min="0" class="w-20 p-1 border rounded"
                 [(ngModel)]="item.discount"
                 (ngModelChange)="updateQuantity(item, item.quantity)" />
        </td>
        <td>{{ item.subtotal | currency:'PKR' }}</td>
        <td>
          <button pButton icon="pi pi-trash" class="p-button-danger" (click)="removeItem(i)"></button>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <!-- Totals and payment -->
  <div class="flex justify-end gap-8 items-end">
    <div class="text-right">
      <p class="mb-1">Subtotal: <strong>{{ subTotal | currency:'PKR' }}</strong></p>
      <p class="mb-1">Tax: <strong>{{ tax | currency:'PKR' }}</strong></p>
      <p class="text-xl font-bold">Grand Total: <strong>{{ grandTotal | currency:'PKR' }}</strong></p>

      <div class="mt-3">
        <label class="block mb-1">Amount Paid</label>
        <input type="number" [(ngModel)]="amountPaid"
               (ngModelChange)="onAmountPaidChange($event)"
               class="w-40 p-2 border rounded" />
      </div>

      <p class="mt-2">Change Due: <strong>{{ changeDue | currency:'PKR' }}</strong></p>
    </div>

    <div class="mt-3 flex gap-2">
  <button 
    pButton 
    icon="pi pi-check" 
    label="Save Sale" 
    class="p-button-success"
    (click)="saveSale()">
  </button>

  <button 
    pButton 
    icon="pi pi-print" 
    label="Print Invoice" 
    class="p-button-info"
    (click)="printInvoice()">
  </button>
</div>

  </div>
</div>
